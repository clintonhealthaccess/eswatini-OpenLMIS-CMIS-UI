<h2>{{'cmisDispense.medications' | message}}</h2>
<section ng-repeat="prescription in vm.visit.prescriptions" class="openlmis-table-container cmis-view">
    <h3>Prescriber</h3>
    <h4>{{prescription.prescriber}}</h4>
    <table>
        <caption ng-if="!prescription.medications.length">{{'cmisDispense.noMedicationFound' | message}}</caption>
        <thead>
            <tr>
                <th></th>
                <th>{{'cmisDispense.name' | message}}</th>
                <th>{{'cmisDispense.dose' | message}}</th>
                <th>{{'cmisDispense.duration' | message}}</th>
                <th>{{'cmisDispense.interval' | message}}</th>
                <th>{{'cmisDispense.stockOnHand' | message}}</th>
                <th>{{'cmisDispense.balance' | message}}</th>
                <th>Substitute</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="medication in prescription.medications">
                <td><input id="assigned" type="checkbox" ng-model="medication.$selected"/></td>
                <td>{{medication.drug_name}}</td>
                <td>{{medication.dose}}</td>
                <td>{{medication.duration}}</td>
                <td>{{medication.interval}}</td>
                <td>{{medication.soh}}</td>
                <td>{{medication.balance}}</td>
                <td><input ng-attr-id="{{medication.drug_id}}" type="checkbox" ng-disabled="vm.disableMedications" ng-click="vm.lockMedications('med', medication.drug_id)"/></td>
            </tr>
        </tbody>
    </table>
</section>

<h2>{{'cmisDispense.substitute' | message}}</h2>
<section class="openlmis-table-container cmis-view">
    <table>
        <caption ng-if="!vm.summaries">{{'cmisDispense.noSubstituteFound' | message}}</caption>
        <thead>
            <tr>
                <th>{{'cmisDispense.name' | message}}</th>
                <th>{{'cmisDispense.dispenseQuantity' | message}}</th>
                <th>{{'cmisDispense.stockOnHand' | message}}</th>
                <th>{{'cmisDispense.balance' | message}}</th>
                <th>Select substitute</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="groups in vm.summaries">
                <td>{{groups[0].orderable.fullProductName}}</td>
                <td>
                    <input
                        id="dispenseQuantity"
                        type="number"
                        min="0"
                        max="{{groups[0].stockOnHand}}"
                        step="1"
                        ng-model="groups[0].dispenseQuantity"/>
                </td>
                <td>{{groups[0].stockOnHand}}</td>
                <td>
                    <input
                        id="balance"
                        type="text"
                        ng-disabled="true"
                        min="0"
                        max="groups[0].stockOnHand"
                        value="{{groups[0].balance = groups[0].stockOnHand - groups[0].dispenseQuantity}}"/>
                </td>
                <td><input type="checkbox" ng-attr-id="{{groups[0].orderable.id}}" ng-disabled="vm.disableSubstitutes" ng-click="vm.lockMedications('sub', groups[0].orderable.id)"/></td>
            </tr>
        </tbody>
    </table>
</section>
